<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/assets/css/styles.css">
    <link rel="shortcut icon" type="image/png" href="/assets/favicon.png" type="image/x-icon">
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Boids | Harry Ganz</title>
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="Boids" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="One of the things I love about natural systems is how complex behavior can arise from sets of simple rules. In biology you see this fairly often, for example Lotka-Volterra equations predict predator-prey interactions and can lead to very complex outcomes despite being incredibly simple. A famous example from the history of computer science is John Conway’s Game of Life which produces incredibly complex (and sometimes unpredictable) interactions between cellular automata from only four rules. A lesser known example are Boids, or bird-oid objects, which demonstrate how three principles, separation, alignment, and cohesion can explain how flocking behavior can arise despite decentralized control. I implemented my own version of the Boids algorithm in Typescript using the HTML5 Canvas element. The complete code can be found in the Github repo." />
<meta property="og:description" content="One of the things I love about natural systems is how complex behavior can arise from sets of simple rules. In biology you see this fairly often, for example Lotka-Volterra equations predict predator-prey interactions and can lead to very complex outcomes despite being incredibly simple. A famous example from the history of computer science is John Conway’s Game of Life which produces incredibly complex (and sometimes unpredictable) interactions between cellular automata from only four rules. A lesser known example are Boids, or bird-oid objects, which demonstrate how three principles, separation, alignment, and cohesion can explain how flocking behavior can arise despite decentralized control. I implemented my own version of the Boids algorithm in Typescript using the HTML5 Canvas element. The complete code can be found in the Github repo." />
<link rel="canonical" href="http://localhost:4000/2024/01/15/boids.html" />
<meta property="og:url" content="http://localhost:4000/2024/01/15/boids.html" />
<meta property="og:site_name" content="Harry Ganz" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-01-15T00:00:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Boids" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-01-15T00:00:00-05:00","datePublished":"2024-01-15T00:00:00-05:00","description":"One of the things I love about natural systems is how complex behavior can arise from sets of simple rules. In biology you see this fairly often, for example Lotka-Volterra equations predict predator-prey interactions and can lead to very complex outcomes despite being incredibly simple. A famous example from the history of computer science is John Conway’s Game of Life which produces incredibly complex (and sometimes unpredictable) interactions between cellular automata from only four rules. A lesser known example are Boids, or bird-oid objects, which demonstrate how three principles, separation, alignment, and cohesion can explain how flocking behavior can arise despite decentralized control. I implemented my own version of the Boids algorithm in Typescript using the HTML5 Canvas element. The complete code can be found in the Github repo.","headline":"Boids","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2024/01/15/boids.html"},"url":"http://localhost:4000/2024/01/15/boids.html"}</script>
<!-- End Jekyll SEO tag -->

</head><body><header>
    <div class="flex flex-col-md-row">
        <img class="site-logo" alt="Bear Logo" src="/assets/img/bear_logo.png" height="64px" width="64px" />
        <a class="site-title flex-item" rel="author" href="/"><h1>Harry Ganz</h1></a>
        
        <nav class="site-nav flex-right">
            <div class="flex flex-col-md-row m-b-0-sm-1">

            
                
                
            
                
                
                    <a class="page-link flex-item" href="/about/">About</a>
                
            
                
                
            
                
                
                    <a class="page-link flex-item" href="/">Home</a>
                
            
                
                
            
        </nav>
        
    </div>
</header><main aria-label="Content">
      <div class="flex flex-column">
        <article class="post">
    
        <h2 class="post-title">Boids</h2>
    

    <div class="post-content"><p>One of the things I love about natural systems is how complex behavior can arise from sets of simple rules. In biology you see this fairly often, for example <a href="https://en.wikipedia.org/wiki/Lotka%E2%80%93Volterra_equations">Lotka-Volterra equations</a> predict predator-prey interactions and can lead to very complex outcomes despite being incredibly simple. A famous example from the history of computer science is John Conway’s <a href="https://en.wikipedia.org/wiki/Conway%27s_Game_of_Life">Game of Life</a> which produces incredibly complex (and sometimes unpredictable) interactions between <em>cellular automata</em> from only four rules. A lesser known example are <a href="https://en.wikipedia.org/wiki/Boids">Boids</a>, or bird-oid objects, which demonstrate how three principles, <em>separation</em>, <em>alignment</em>, and <em>cohesion</em> can explain how flocking behavior can arise despite decentralized control. I implemented my own version of the Boids algorithm in Typescript using the HTML5 Canvas element. <a href="https://github.com/harryganz/boids">The complete code can be found in the Github repo</a>.</p>

<p>You can play with the demo before jumping into the code:</p>

<script src="/assets/js/boids.js" defer=""></script>

<link rel="stylesheet" href="/assets/css/boids.css" />

<div id="content">
    <div id="controls">
        <div class="control-group">
            <label for="number">Number</label>
            <input name="number" type="range" min="10" max="60" value="30" />
        </div>
        <div class="control-group">
            <label for="size">Size</label>
            <input name="size" type="range" min="2" max="10" value="5" />
        </div>
        <div class="control-group">
            <label for="avoidFactor">Avoid Factor</label>
            <input name="avoidFactor" type="range" min="0" max="100" value="50" />
        </div>
        <div class="control-group">
            <label for="cohereFactor">Cohere Factor</label>
            <input name="cohereFactor" type="range" min="0" max="100" value="50" />
        </div>
        <div class="control-group">
            <label for="alignFactor">Align Factor</label>
            <input name="alignFactor" type="range" min="0" max="100" value="50" />
        </div>
        <div class="control-group">
                <label for="minSpeed">Min Speed</label>
                <input name="minSpeed" type="range" min="0" max="100" value="50" />
        </div>
        <div class="control-group">
            <label for="maxSpeed">Max Speed</label>
            <input name="maxSpeed" type="range" min="0" max="100" value="50" />
        </div>
    </div>
    <div id="canvas-container">
        <canvas id="canvas" width="600" height="480"></canvas>
    </div>
    <div id="play-buttons">
        <button id="start-btn">Start</button>
        <button id="stop-btn">Stop</button>
    </div>
</div>

<h3 id="understanding-boids">Understanding Boids</h3>

<p>The flocking behavior in boids is an emergent property of three different rules:</p>

<ol>
  <li>Try to stay near the central position of your neighbors (cohere)</li>
  <li>Try to get away from very close neighbors (avoid)</li>
  <li>Try to move in the same direction as you neighbors (align)</li>
</ol>

<p>While each of these rules is applied independently of one another, they lead to complex flocking behavior when taken together.</p>

<h3 id="implementation">Implementation</h3>

<p>To implement boids, I created two classes:</p>

<ul>
  <li>A Boid class which has fields for its current x, y position on the canvas as well as its horizontal velocity, vx, and its vertical velocity vy.</li>
  <li>A BoidContainer which has fields for a list of boids, references to the canvas element and rendering context, and a list of values for the neighbor distance, avoid factor, align factor, etc. which are shared by all the boids.</li>
</ul>

<p>I also added methods to have the boids avoid the walls of the container, collision detection, clamp boid speed to between a minimum and maximum, and some convenience methods to modify parameters while the simulation is running.</p>

<p>One thing I did not do is have boids detect collisions with each other, or optimize how the BoidContainer detects neighbors. In theory, something like an <a href="https://www.azurefromthetrenches.com/introductory-guide-to-aabb-tree-collision-detection/">AABB tree (Axis Aligned Bounding Box)</a> would make finding neighbors more efficient (currently, it checks the distance of each boid against every other boid). That being said, despite the O(n<sup>2</sup>) complexity, it seems to run fine. I might attempt another version with collision detection and a real data structure to detect distance to other boids so that I can push the number of boids to something obscene. I also might see if I can change the color of the boids based on the average distance to neighbors.</p>

<figure class="highlight"><pre><code class="language-typescript" data-lang="typescript"><span class="kd">type</span> <span class="nx">DefaultCanvasOpts</span> <span class="o">=</span> <span class="p">{</span>
	<span class="na">avoidFactor</span><span class="p">:</span> <span class="kr">number</span>
	<span class="na">alignFactor</span><span class="p">:</span> <span class="kr">number</span>
	<span class="na">cohereFactor</span><span class="p">:</span> <span class="kr">number</span>
	<span class="na">neighborDist</span><span class="p">:</span> <span class="kr">number</span>
	<span class="na">closeDist</span><span class="p">:</span> <span class="kr">number</span>
	<span class="na">buffer</span><span class="p">:</span> <span class="kr">number</span>
	<span class="na">minSpeed</span><span class="p">:</span> <span class="kr">number</span>
	<span class="na">maxSpeed</span><span class="p">:</span> <span class="kr">number</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">CanvasOpts</span> <span class="o">=</span> <span class="nx">DefaultCanvasOpts</span> <span class="o">&amp;</span> <span class="p">{</span>
	<span class="na">width</span><span class="p">:</span> <span class="kr">number</span>
	<span class="na">height</span><span class="p">:</span> <span class="kr">number</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">OptionalCanvasOpts</span> <span class="o">=</span> <span class="nb">Partial</span><span class="o">&lt;</span><span class="nx">CanvasOpts</span><span class="o">&gt;</span><span class="p">;</span>

<span class="kd">type</span> <span class="nx">CanvasOptKey</span> <span class="o">=</span> <span class="kr">keyof</span> <span class="nx">DefaultCanvasOpts</span><span class="p">;</span>

<span class="kd">type</span> <span class="nx">BoidOpts</span> <span class="o">=</span> <span class="p">{</span>
	<span class="nx">vx</span><span class="p">?:</span> <span class="kr">number</span>
	<span class="nx">vy</span><span class="p">?:</span> <span class="kr">number</span>
	<span class="nx">size</span><span class="p">?:</span> <span class="kr">number</span>
	<span class="nx">color</span><span class="p">?:</span> <span class="kr">string</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">defaultCanvasOpts</span><span class="p">:</span> <span class="nx">DefaultCanvasOpts</span> <span class="o">=</span> <span class="p">{</span>
	<span class="na">avoidFactor</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>
	<span class="na">cohereFactor</span><span class="p">:</span> <span class="mf">0.03</span><span class="p">,</span>
	<span class="na">alignFactor</span><span class="p">:</span> <span class="mf">0.02</span><span class="p">,</span>
	<span class="na">neighborDist</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
	<span class="na">closeDist</span><span class="p">:</span> <span class="mi">33</span><span class="p">,</span>
	<span class="na">minSpeed</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
	<span class="na">maxSpeed</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> 
	<span class="na">buffer</span><span class="p">:</span> <span class="mi">100</span>
<span class="p">};</span>

<span class="kd">class</span> <span class="nc">Boid</span> <span class="p">{</span>
	<span class="nl">x</span><span class="p">:</span> <span class="kr">number</span>
	<span class="nx">y</span><span class="p">:</span> <span class="kr">number</span>
	<span class="nx">vx</span><span class="p">:</span> <span class="kr">number</span>
	<span class="nx">vy</span><span class="p">:</span> <span class="kr">number</span>
	<span class="k">private</span> <span class="nx">size</span><span class="p">:</span> <span class="kr">number</span>
	<span class="k">private</span> <span class="nx">color</span><span class="p">:</span> <span class="kr">string</span>
	<span class="k">private</span> <span class="nx">canvasOpts</span><span class="p">:</span> <span class="nx">CanvasOpts</span>

	<span class="cm">/**
	 * Boid represents a "bird like object" that engages in flocking behavior with other boids.
	 * 
	 * @param x The x position on the canvas
	 * @param y The y position on the canvas
	 * @param canvasOpts Values shared by all boids on the canvas, such as alignFactor, cohereFactor, maxSpeed, etc.
	 * @param opts Options for an individual boid, such as size, color, vx, vy, etc.
	 */</span>
	<span class="nf">constructor</span><span class="p">(</span><span class="nx">x</span><span class="p">:</span> <span class="kr">number</span><span class="p">,</span> <span class="nx">y</span><span class="p">:</span> <span class="kr">number</span><span class="p">,</span> <span class="nx">canvasOpts</span><span class="p">:</span> <span class="nx">CanvasOpts</span><span class="p">,</span> <span class="nx">opts</span><span class="p">?:</span> <span class="nx">BoidOpts</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">const</span> <span class="p">{</span><span class="nx">vx</span><span class="p">,</span> <span class="nx">vy</span><span class="p">,</span> <span class="nx">size</span><span class="p">,</span> <span class="nx">color</span><span class="p">}</span> <span class="o">=</span> <span class="nx">opts</span> <span class="o">||</span> <span class="p">{};</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">y</span><span class="p">;</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">canvasOpts</span> <span class="o">=</span> <span class="nx">canvasOpts</span><span class="p">;</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">vx</span> <span class="o">=</span> <span class="nx">vx</span> <span class="o">||</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">vy</span> <span class="o">=</span> <span class="nx">vy</span> <span class="o">||</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">size</span> <span class="o">=</span> <span class="nx">size</span> <span class="o">||</span> <span class="mi">5</span><span class="p">;</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="nx">color</span> <span class="o">||</span> <span class="dl">"</span><span class="s2">#000000</span><span class="dl">"</span><span class="p">;</span>
	<span class="p">}</span>


	<span class="cm">/**
	 * Set options for this boid
	 */</span>
	<span class="nf">setOpts</span><span class="p">(</span><span class="nx">opts</span><span class="p">:</span> <span class="nx">BoidOpts</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">vx</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">vx</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">vx</span><span class="p">;</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">vy</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">vy</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">vy</span><span class="p">;</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">size</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">size</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">size</span><span class="p">;</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">color</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">color</span><span class="p">;</span> 
	<span class="p">}</span>

	<span class="cm">/**
	 * Draws the current point
	 * @param ctx The canvas rendering context.
	 */</span>
	<span class="nf">draw</span><span class="p">(</span><span class="nx">ctx</span><span class="p">:</span> <span class="nx">CanvasRenderingContext2D</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span>
		<span class="c1">// Creates a circle</span>
		<span class="nx">ctx</span><span class="p">.</span><span class="nf">arc</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">size</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">);</span>
		<span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">color</span><span class="p">;</span>
		<span class="nx">ctx</span><span class="p">.</span><span class="nf">closePath</span><span class="p">();</span>
		<span class="nx">ctx</span><span class="p">.</span><span class="nf">fill</span><span class="p">();</span>
	<span class="p">}</span>

	<span class="cm">/** Updates poistion of current boid
	 * @param dt The difference, in milliseconds, since last update
	 * @param neighbors An array of neighbor boids
	 * 
	 */</span>
	<span class="nf">update</span><span class="p">(</span><span class="nx">dt</span><span class="p">:</span> <span class="kr">number</span><span class="p">,</span> <span class="nx">neighbors</span><span class="p">:</span> <span class="nx">Boid</span><span class="p">[]):</span> <span class="k">void</span> <span class="p">{</span>
		<span class="kd">const</span> <span class="p">{</span><span class="nx">closeDist</span><span class="p">}</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">canvasOpts</span><span class="p">;</span>
		<span class="c1">// Separate from close neighbors</span>
		<span class="k">this</span><span class="p">.</span><span class="nf">separate</span><span class="p">(</span><span class="nx">neighbors</span><span class="p">.</span><span class="nf">filter</span><span class="p">(</span><span class="nx">boid</span> <span class="o">=&gt;</span> <span class="nf">dist</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">boid</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nx">closeDist</span><span class="p">));</span>
		<span class="c1">// Align with neighbors</span>
		<span class="k">this</span><span class="p">.</span><span class="nf">align</span><span class="p">(</span><span class="nx">neighbors</span><span class="p">);</span>
		<span class="c1">// Cohere with neighbors</span>
		<span class="k">this</span><span class="p">.</span><span class="nf">cohere</span><span class="p">(</span><span class="nx">neighbors</span><span class="p">);</span>
		<span class="c1">// Avoid walls</span>
		<span class="k">this</span><span class="p">.</span><span class="nf">avoidWalls</span><span class="p">();</span>
		<span class="c1">// Clamp between min and max speed</span>
		<span class="k">this</span><span class="p">.</span><span class="nf">clampSpeed</span><span class="p">();</span>
	
		<span class="kd">const</span> <span class="nx">timeFactor</span> <span class="o">=</span> <span class="nx">dt</span><span class="o">/</span><span class="mi">1000</span><span class="p">;</span>
		<span class="kd">const</span> <span class="p">[</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">dy</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">vx</span><span class="o">*</span><span class="nx">timeFactor</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">vy</span><span class="o">*</span><span class="nx">timeFactor</span><span class="p">];</span>
		<span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nf">isCollided</span><span class="p">(</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">dy</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">+=</span> <span class="nx">dx</span><span class="p">;</span> 
			<span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="nx">dy</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="c1">// Returns true if boid has collided with canvas walls</span>
	<span class="c1">// will also set position to just have bounced off of wall if </span>
	<span class="c1">// collided</span>
	<span class="c1">// NOTE: Probably should set value to where it would be if it </span>
	<span class="c1">// had collided</span>
	<span class="k">private</span> <span class="nf">isCollided</span><span class="p">(</span><span class="nx">dx</span><span class="p">:</span> <span class="kr">number</span><span class="p">,</span> <span class="nx">dy</span><span class="p">:</span> <span class="kr">number</span><span class="p">):</span> <span class="nx">boolean</span> <span class="p">{</span>
		<span class="kd">const</span> <span class="p">{</span><span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">}</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">canvasOpts</span><span class="p">;</span>
		<span class="kd">let</span> <span class="nx">collided</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
		<span class="c1">// Collided with left side</span>
		<span class="k">if </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">dx</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">size</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">size</span><span class="p">;</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">vx</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">vx</span><span class="p">);</span>
			<span class="nx">collided</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="c1">// Collided with right side</span>
		<span class="k">if </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">dx</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">size</span> <span class="o">&gt;</span> <span class="nx">width</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">width</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">size</span><span class="p">;</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">vx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">vx</span><span class="p">);</span>
			<span class="nx">collided</span> <span class="o">=</span> <span class="kc">true</span>
		<span class="p">}</span>
		<span class="c1">// Collided with top</span>
		<span class="k">if </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">dy</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">size</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">size</span><span class="p">;</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">vy</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">vy</span><span class="p">);</span>
			<span class="nx">collided</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="c1">// Collided with bottom</span>
		<span class="k">if </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">dy</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">size</span> <span class="o">&gt;</span> <span class="nx">height</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">height</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">size</span><span class="p">;</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">vy</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">vy</span><span class="p">);</span>
			<span class="nx">collided</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">return</span> <span class="nx">collided</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="c1">// Pushes boid away from walls </span>
	<span class="k">private</span> <span class="nf">avoidWalls</span><span class="p">()</span> <span class="p">{</span>
		<span class="kd">const</span> <span class="p">{</span><span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">,</span> <span class="nx">buffer</span><span class="p">,</span> <span class="nx">avoidFactor</span><span class="p">}</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">canvasOpts</span><span class="p">;</span>
		<span class="kd">let</span> <span class="p">[</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">dy</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">];</span>
		<span class="k">if </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="nx">buffer</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">dx</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>	
		<span class="k">if </span><span class="p">(</span><span class="nx">width</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">buffer</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">dx</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">width</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">if </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="nx">buffer</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">dy</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">if </span><span class="p">(</span><span class="nx">height</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">&lt;</span> <span class="nx">buffer</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">dy</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">height</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">this</span><span class="p">.</span><span class="nx">vx</span> <span class="o">+=</span> <span class="nx">dx</span><span class="o">*</span><span class="nx">avoidFactor</span><span class="p">;</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">vy</span> <span class="o">+=</span> <span class="nx">dy</span><span class="o">*</span><span class="nx">avoidFactor</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="c1">// Pushes boid away from close neighbors</span>
	<span class="k">private</span> <span class="nf">separate</span><span class="p">(</span><span class="nx">closeNeighbors</span><span class="p">:</span> <span class="nx">Boid</span><span class="p">[]):</span><span class="k">void</span> <span class="p">{</span>
		<span class="c1">// Initialize the sum of the x, y distance to neighbors to zero</span>
		<span class="kd">let</span> <span class="p">[</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">dy</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">];</span>
		<span class="kd">const</span> <span class="p">{</span><span class="nx">avoidFactor</span><span class="p">}</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">canvasOpts</span><span class="p">;</span>

		<span class="c1">// Sum up the x and y distance for all close neighbors</span>
		<span class="k">for </span><span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">closeNeighbors</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">dx</span> <span class="o">+=</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">closeNeighbors</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">x</span><span class="p">;</span>
			<span class="nx">dy</span> <span class="o">+=</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">closeNeighbors</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">y</span><span class="p">;</span>
		<span class="p">}</span> 

		<span class="c1">// Update current boid's x, y velocity component so that</span>
		<span class="c1">// it moves away from close boids</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">vx</span> <span class="o">+=</span> <span class="nx">dx</span><span class="o">*</span><span class="nx">avoidFactor</span><span class="p">;</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">vy</span> <span class="o">+=</span> <span class="nx">dy</span><span class="o">*</span><span class="nx">avoidFactor</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="c1">// Aligns boid's velocity vector with neighbors</span>
	<span class="k">private</span> <span class="nf">align</span><span class="p">(</span><span class="nx">neighbors</span><span class="p">:</span> <span class="nx">Boid</span><span class="p">[]):</span><span class="k">void</span> <span class="p">{</span>
		<span class="c1">// Initialize the average x and y velocities and number of neighbors to 0</span>
		<span class="kd">let</span> <span class="p">[</span><span class="nx">vx_avg</span><span class="p">,</span> <span class="nx">vy_avg</span><span class="p">,</span> <span class="nx">n</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">];</span>

		<span class="kd">const</span> <span class="p">{</span><span class="nx">alignFactor</span><span class="p">}</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">canvasOpts</span><span class="p">;</span>

		<span class="c1">// Calculate sum of velocities and number of neighbors</span>
		<span class="k">for </span><span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">neighbors</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">vx_avg</span> <span class="o">+=</span> <span class="nx">neighbors</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">vx</span><span class="p">;</span>
			<span class="nx">vy_avg</span> <span class="o">+=</span> <span class="nx">neighbors</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">vy</span><span class="p">;</span>
			<span class="nx">n</span><span class="o">++</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="c1">// Get the average x, y component of neighbor velocity </span>
		<span class="k">if </span><span class="p">(</span><span class="nx">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">vx_avg</span> <span class="o">=</span> <span class="nx">vx_avg</span><span class="o">/</span><span class="nx">n</span><span class="p">;</span>
			<span class="nx">vy_avg</span> <span class="o">=</span> <span class="nx">vy_avg</span><span class="o">/</span><span class="nx">n</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="c1">// Set current boid's velocity so that the closer it is to the average</span>
		<span class="c1">// the less it changes</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">vx</span> <span class="o">+=</span> <span class="p">(</span><span class="nx">vx_avg</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">vx</span><span class="p">)</span><span class="o">*</span><span class="nx">alignFactor</span><span class="p">;</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">vy</span> <span class="o">+=</span> <span class="p">(</span><span class="nx">vy_avg</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">vy</span><span class="p">)</span><span class="o">*</span><span class="nx">alignFactor</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="c1">// Pushes boid towards center of neighbors</span>
	<span class="k">private</span> <span class="nf">cohere</span><span class="p">(</span><span class="nx">neighbors</span><span class="p">:</span> <span class="nx">Boid</span><span class="p">[]):</span> <span class="k">void</span> <span class="p">{</span>
		<span class="c1">// Initialize the average x,y position and number of neighbors to zero</span>
		<span class="kd">let</span> <span class="p">[</span><span class="nx">px_avg</span><span class="p">,</span> <span class="nx">py_avg</span><span class="p">,</span> <span class="nx">n</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">];</span>
	
		<span class="kd">const</span> <span class="p">{</span><span class="nx">cohereFactor</span><span class="p">}</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">canvasOpts</span><span class="p">;</span>

		<span class="c1">// Sum up the x, y and number of neighbors</span>
		<span class="k">for </span><span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">neighbors</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">px_avg</span> <span class="o">+=</span> <span class="nx">neighbors</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">x</span><span class="p">;</span>
			<span class="nx">py_avg</span> <span class="o">+=</span> <span class="nx">neighbors</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">y</span><span class="p">;</span>
			<span class="nx">n</span><span class="o">++</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">if </span><span class="p">(</span><span class="nx">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="c1">// Get the average x, y position</span>
			<span class="nx">px_avg</span> <span class="o">=</span> <span class="nx">px_avg</span><span class="o">/</span><span class="nx">n</span><span class="p">;</span>
			<span class="nx">py_avg</span> <span class="o">=</span> <span class="nx">py_avg</span><span class="o">/</span><span class="nx">n</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="c1">// Set the x, y components of the velocity so that </span>
		<span class="c1">// the closer to the center of neighbors, the less it changes</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">vx</span> <span class="o">+=</span> <span class="p">(</span><span class="nx">px_avg</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="o">*</span><span class="nx">cohereFactor</span><span class="p">;</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">vy</span> <span class="o">+=</span> <span class="p">(</span><span class="nx">py_avg</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="o">*</span><span class="nx">cohereFactor</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="c1">// Clamps speed to limits</span>
	<span class="k">private</span> <span class="nf">clampSpeed</span><span class="p">():</span> <span class="k">void</span> <span class="p">{</span>
		<span class="kd">const</span> <span class="p">{</span><span class="nx">maxSpeed</span><span class="p">,</span> <span class="nx">minSpeed</span><span class="p">}</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">canvasOpts</span><span class="p">;</span>
		<span class="kd">const</span> <span class="nx">speed</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nf">pow</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">vx</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">pow</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">vy</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
		<span class="k">if </span><span class="p">(</span><span class="nx">speed</span> <span class="o">&gt;</span> <span class="nx">maxSpeed</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">vx</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">vx</span><span class="o">/</span><span class="nx">speed</span><span class="p">)</span><span class="o">*</span><span class="nx">maxSpeed</span><span class="p">;</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">vy</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">vy</span><span class="o">/</span><span class="nx">speed</span><span class="p">)</span><span class="o">*</span><span class="nx">maxSpeed</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">if </span><span class="p">(</span><span class="nx">speed</span> <span class="o">&lt;</span> <span class="nx">minSpeed</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">vx</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">vx</span><span class="o">/</span><span class="nx">speed</span><span class="p">)</span><span class="o">*</span><span class="nx">minSpeed</span><span class="p">;</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">vy</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">vy</span><span class="o">/</span><span class="nx">speed</span><span class="p">)</span><span class="o">*</span><span class="nx">minSpeed</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>  

<span class="cm">/** Returns the Euclidean distance between two points in 2D space
 * @param p1 A 2D Cartesian point {x, y} 
 * @param p2 A 2D Cartesian point {x, y}
 * @return The distance (in same units as input) between p1 and p2
 */</span>
<span class="kd">function</span> <span class="nf">dist</span><span class="p">(</span><span class="nx">p1</span><span class="p">:</span> <span class="p">{</span><span class="nl">x</span><span class="p">:</span> <span class="kr">number</span><span class="p">,</span> <span class="nx">y</span><span class="p">:</span> <span class="kr">number</span><span class="p">},</span> <span class="nx">p2</span><span class="p">:</span> <span class="p">{</span><span class="nl">x</span><span class="p">:</span> <span class="kr">number</span><span class="p">,</span> <span class="nx">y</span><span class="p">:</span> <span class="kr">number</span><span class="p">}):</span> <span class="kr">number</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nf">pow</span><span class="p">(</span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">p2</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">pow</span><span class="p">(</span><span class="nx">p1</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">p2</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">BoidContainer</span> <span class="p">{</span>
	<span class="nl">boids</span><span class="p">:</span> <span class="nx">Boid</span><span class="p">[];</span>
	<span class="nl">n</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
	<span class="nl">canvasOpts</span><span class="p">:</span> <span class="nx">CanvasOpts</span><span class="p">;</span>
	<span class="nl">defaultBoidOpts</span><span class="p">:</span> <span class="nx">BoidOpts</span><span class="p">;</span>
	<span class="nl">canvas</span><span class="p">:</span> <span class="nx">HTMLCanvasElement</span><span class="p">;</span>
	<span class="nl">ctx</span><span class="p">:</span> <span class="nx">CanvasRenderingContext2D</span><span class="p">;</span>
	<span class="nl">running</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">;</span>

	<span class="k">private</span> <span class="nx">previousTimestamp</span><span class="p">:</span> <span class="kr">number</span> <span class="o">|</span> <span class="kc">undefined</span> <span class="o">|</span> <span class="kc">null</span><span class="p">;</span>

	<span class="cm">/**
	 * BoidContainer  
	 * @param canvas 
	 * @param n 
	 * @param defaultBoidOpts 
	 */</span>
	<span class="nf">constructor</span><span class="p">(</span><span class="nx">canvas</span><span class="p">:</span> <span class="nx">HTMLCanvasElement</span><span class="p">,</span> <span class="nx">n</span><span class="p">:</span> <span class="kr">number</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="nx">defaultBoidOpts</span><span class="p">:</span> <span class="nx">BoidOpts</span> <span class="o">=</span> <span class="p">{</span><span class="na">size</span><span class="p">:</span> <span class="mi">5</span><span class="p">})</span> <span class="p">{</span>
		<span class="kd">const</span> <span class="p">{</span> <span class="nx">avoidFactor</span><span class="p">,</span> <span class="nx">alignFactor</span><span class="p">,</span> <span class="nx">cohereFactor</span><span class="p">,</span> <span class="nx">neighborDist</span><span class="p">,</span> <span class="nx">closeDist</span><span class="p">,</span> <span class="nx">minSpeed</span><span class="p">,</span> <span class="nx">maxSpeed</span><span class="p">,</span> <span class="nx">buffer</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">defaultCanvasOpts</span><span class="p">;</span>
		<span class="k">if </span><span class="p">(</span><span class="nx">canvas</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">throw</span> <span class="dl">'</span><span class="s1">Canvas element is null</span><span class="dl">'</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="kd">const</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nf">getContext</span><span class="p">(</span><span class="dl">'</span><span class="s1">2d</span><span class="dl">'</span><span class="p">);</span>
		<span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">throw</span> <span class="dl">'</span><span class="s1">Browser does not support 2D canvas context</span><span class="dl">'</span>
		<span class="p">}</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">canvas</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">;</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">ctx</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">;</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">boids</span> <span class="o">=</span> <span class="p">[];</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">n</span> <span class="o">=</span> <span class="nx">n</span><span class="p">;</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">canvasOpts</span> <span class="o">=</span> <span class="p">{</span>
			<span class="na">width</span><span class="p">:</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span>
			<span class="na">height</span><span class="p">:</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">,</span>
			<span class="na">avoidFactor</span><span class="p">:</span> <span class="nx">avoidFactor</span><span class="p">,</span>
			<span class="na">alignFactor</span><span class="p">:</span> <span class="nx">alignFactor</span><span class="p">,</span>
			<span class="na">cohereFactor</span><span class="p">:</span> <span class="nx">cohereFactor</span><span class="p">,</span>
			<span class="na">neighborDist</span><span class="p">:</span> <span class="nx">neighborDist</span><span class="p">,</span>
			<span class="na">closeDist</span><span class="p">:</span> <span class="nx">closeDist</span><span class="p">,</span>
			<span class="na">buffer</span><span class="p">:</span> <span class="nx">buffer</span><span class="p">,</span>
			<span class="na">minSpeed</span><span class="p">:</span> <span class="nx">minSpeed</span><span class="p">,</span>
			<span class="na">maxSpeed</span><span class="p">:</span> <span class="nx">maxSpeed</span> 
		<span class="p">};</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">defaultBoidOpts</span> <span class="o">=</span> <span class="nx">defaultBoidOpts</span><span class="p">;</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">running</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
	<span class="p">}</span>
	
	<span class="cm">/**
	 * Initialize the boids on the canvas
	 */</span>
	<span class="nf">init</span><span class="p">()</span> <span class="p">:</span> <span class="k">void</span> <span class="p">{</span>
		<span class="c1">// Reset canvas, if anything is currently there</span>
		<span class="c1">//</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nf">beginPath</span><span class="p">();</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nf">clearRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nf">stroke</span><span class="p">();</span>

		<span class="c1">// Clear boids, if they are there</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">boids</span> <span class="o">=</span> <span class="p">[];</span>
		<span class="c1">// Create n boids</span>
		<span class="k">for </span><span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">n</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">const</span> <span class="nx">boid</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Boid</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nf">random</span><span class="p">()</span><span class="o">*</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">canvasOpts</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="mi">20</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">random</span><span class="p">()</span><span class="o">*</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">canvasOpts</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="mi">20</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">canvasOpts</span><span class="p">,</span> <span class="p">{...</span><span class="k">this</span><span class="p">.</span><span class="nx">defaultBoidOpts</span><span class="p">,</span> <span class="na">vx</span><span class="p">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">random</span><span class="p">()</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="k">this</span><span class="p">.</span><span class="nx">canvasOpts</span><span class="p">.</span><span class="nx">maxSpeed</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">canvasOpts</span><span class="p">.</span><span class="nx">maxSpeed</span><span class="p">,</span> <span class="na">vy</span><span class="p">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">random</span><span class="p">()</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="k">this</span><span class="p">.</span><span class="nx">canvasOpts</span><span class="p">.</span><span class="nx">maxSpeed</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">canvasOpts</span><span class="p">.</span><span class="nx">maxSpeed</span><span class="p">});</span> 
			<span class="k">this</span><span class="p">.</span><span class="nx">boids</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="nx">boid</span><span class="p">);</span>
			<span class="nx">boid</span><span class="p">.</span><span class="nf">draw</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ctx</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">private</span> <span class="nf">step</span><span class="p">(</span><span class="nx">timestamp</span><span class="p">:</span> <span class="kr">number</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">previousTimestamp</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">previousTimestamp</span> <span class="o">=</span> <span class="nx">timestamp</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="kd">const</span> <span class="nx">dt</span> <span class="o">=</span> <span class="nx">timestamp</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">previousTimestamp</span> <span class="c1">// dt in milliseconds</span>


		<span class="k">this</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nf">beginPath</span><span class="p">();</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nf">clearRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nf">stroke</span><span class="p">();</span>

		<span class="k">this</span><span class="p">.</span><span class="nx">boids</span><span class="p">.</span><span class="nf">forEach</span><span class="p">(</span><span class="nx">boid</span> <span class="o">=&gt;</span> <span class="p">{</span>
			<span class="kd">const</span> <span class="nx">neighbors</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">boids</span><span class="p">.</span><span class="nf">filter</span><span class="p">(</span><span class="nx">neighbor</span> <span class="o">=&gt;</span> <span class="nx">neighbor</span> <span class="o">!==</span> <span class="nx">boid</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nf">dist</span><span class="p">(</span><span class="nx">boid</span><span class="p">,</span> <span class="nx">neighbor</span><span class="p">)</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">canvasOpts</span><span class="p">.</span><span class="nx">neighborDist</span><span class="p">));</span>
			<span class="nx">boid</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="nx">dt</span><span class="p">,</span> <span class="nx">neighbors</span><span class="p">);</span>
			<span class="nx">boid</span><span class="p">.</span><span class="nf">draw</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ctx</span><span class="p">);</span>
		<span class="p">});</span>

		<span class="k">this</span><span class="p">.</span><span class="nx">previousTimestamp</span> <span class="o">=</span> <span class="nx">timestamp</span><span class="p">;</span>
		
		<span class="k">if </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">running</span><span class="p">)</span> <span class="p">{</span>
			<span class="nb">window</span><span class="p">.</span><span class="nf">requestAnimationFrame</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">step</span><span class="p">.</span><span class="nf">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>		
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="cm">/**
	 * Sets the number of boids
	 * 
	 * @param n The number of boids to be drawn on the canvas
	 */</span>
	<span class="nf">setNumber</span><span class="p">(</span><span class="nx">n</span><span class="p">:</span> <span class="kr">number</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span>
		<span class="kd">const</span> <span class="nx">d</span> <span class="o">=</span> <span class="nx">n</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">n</span><span class="p">;</span>
		<span class="k">if </span><span class="p">(</span><span class="nx">d</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">for </span><span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">d</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="kd">const</span> <span class="nx">boid</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Boid</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nf">random</span><span class="p">()</span><span class="o">*</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">canvasOpts</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="mi">20</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">random</span><span class="p">()</span><span class="o">*</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">canvasOpts</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="mi">20</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">canvasOpts</span><span class="p">,</span> <span class="p">{...</span><span class="k">this</span><span class="p">.</span><span class="nx">defaultBoidOpts</span><span class="p">,</span> <span class="na">vx</span><span class="p">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">random</span><span class="p">()</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="k">this</span><span class="p">.</span><span class="nx">canvasOpts</span><span class="p">.</span><span class="nx">maxSpeed</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">canvasOpts</span><span class="p">.</span><span class="nx">maxSpeed</span><span class="p">,</span> <span class="na">vy</span><span class="p">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">random</span><span class="p">()</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="k">this</span><span class="p">.</span><span class="nx">canvasOpts</span><span class="p">.</span><span class="nx">maxSpeed</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">canvasOpts</span><span class="p">.</span><span class="nx">maxSpeed</span><span class="p">});</span> 
				<span class="k">this</span><span class="p">.</span><span class="nx">boids</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="nx">boid</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">boids</span><span class="p">.</span><span class="nf">splice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="nx">d</span><span class="p">));</span>
		<span class="p">}</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">n</span> <span class="o">=</span> <span class="nx">n</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/**
	 * Start the animation
	 */</span>
	<span class="nf">start</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">running</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
		<span class="nb">window</span><span class="p">.</span><span class="nf">requestAnimationFrame</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">step</span><span class="p">.</span><span class="nf">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
	<span class="p">}</span>

	<span class="cm">/**
	 * Stop the animation
	 */</span>
	<span class="nf">stop</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">running</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">previousTimestamp</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/**
	 * Sets one or more canvas options to be shared by all boids currently being drawn
	 * 
	 * @param opts One of more canvas options to set for all boids, e.g. avoidFactor, cohereFactor, maxSpeed
	 */</span>
	<span class="nf">setCanvasOpts</span><span class="p">(</span><span class="nx">opts</span><span class="p">:</span> <span class="nx">OptionalCanvasOpts</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">canvasOpts</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nf">assign</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">canvasOpts</span><span class="p">,</span> <span class="nx">opts</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="cm">/**
	 *  Sets one ore more boid options to be shared by all boids currently being drawn
	 * 
	 * @param opts One or more boid options to set for all boids, e.g. size, color
	 */</span>
	<span class="nf">setBoidOpts</span><span class="p">(</span><span class="nx">opts</span><span class="p">:</span> <span class="nx">BoidOpts</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">defaultBoidOpts</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nf">assign</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">defaultBoidOpts</span><span class="p">,</span> <span class="nx">opts</span><span class="p">);</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">boids</span><span class="p">.</span><span class="nf">forEach</span><span class="p">(</span><span class="nx">boid</span> <span class="o">=&gt;</span> <span class="nx">boid</span><span class="p">.</span><span class="nf">setOpts</span><span class="p">(</span><span class="nx">opts</span><span class="p">));</span>
	<span class="p">}</span>
<span class="p">}</span></code></pre></figure>
</div>

    
    
        
    
        
            

    <div class="flex flex-row m-t-3">
        <div class="flex-item">
            
                
                
                <a href="/2023/06/04/whitebox-vs-blackbox-testing.html">Previous Post: Whitebox vs. Blackbox ...</a>
            
        </div>
        <div class="flex-item flex-right">
            
            
                
                
                <a href="/2024/02/27/are-houses-actually-more-expensive.html">Next Post: Are Houses Actually Mo...</a>
            
        </div>

    </div>


</article>
      </div>
    </main>
  </body>

</html>
